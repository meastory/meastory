:root {
  --color-primary: #2C3E7A; /* Bedtime Blue */
  --color-accent: #FF6B6B; /* Warm Coral for tell */
  --color-ink: #1B1E28;
  --color-slate: #6B7280;
  --color-mist: #E5E7EB;
  --color-cloud: #F7F7FA;
  --color-white: #FFFFFF;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Nunito', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
  color: var(--color-ink);
  background: var(--color-cloud);
  line-height: 1.6;
}

.site-header {
  background: var(--color-primary);
  color: var(--color-white);
  padding: 24px 16px;
  text-align: center;
}
.site-header h1 { margin: 0; font-family: 'Fraunces', serif; }
.site-header .tagline { margin: 4px 0 0; opacity: 0.9; }

.container {
  max-width: 960px;
  margin: 24px auto;
  padding: 0 16px;
}

.session-card, .story-card {
  background: var(--color-white);
  border: 1px solid var(--color-mist);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}

.form-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.input {
  flex: 1 1 200px;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid var(--color-mist);
}

.btn {
  padding: 10px 14px;
  border: none;
  border-radius: 8px;
  background: var(--color-mist);
  color: var(--color-ink);
  cursor: pointer;
}
.btn.primary { background: var(--color-accent); color: var(--color-white); }
.btn:disabled { opacity: 0.6; cursor: not-allowed; }

.story-card { position: relative; overflow: hidden; }
.background {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  opacity: 0.2;
}
.story-content { position: relative; }
.choices { display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0; }
.hint { color: var(--color-slate); font-size: 14px; }
.safety-note { color: var(--color-slate); font-size: 14px; text-align: center; }

.video-card { background: var(--color-white); border: 1px solid var(--color-mist); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
.video-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.video-box { position: relative; background: #000; border-radius: 8px; overflow: hidden; min-height: 160px; }
.video-box video { width: 100%; height: 100%; object-fit: cover; }

/* Storybook mode (behind ?storybook=1) */
.storybook-mode body {
  background: #f6f3ea;
}
.storybook-mode .site-header {
  background: transparent;
  color: var(--color-ink);
}
.storybook-mode .story-card {
  background: #fff;
  border: 0;
  box-shadow: none;
}
.storybook-mode .background { opacity: 0.35; }
.storybook-mode .story-content {
  max-width: 60ch;
  margin: 0 auto;
  padding: 20px 16px 24px;
  font-family: 'Nunito', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
  font-size: 18px;
  line-height: 1.8;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
@media (min-width: 768px) {
  .storybook-mode .story-content { font-size: 20px; }
}
.storybook-mode #storyTitle {
  font-family: 'Fraunces', serif;
  font-weight: 900;
  font-size: 28px;
  margin: 6px 0 14px;
  letter-spacing: 0.2px;
}
@media (min-width: 768px) {
  .storybook-mode #storyTitle { font-size: 36px; }
}
.storybook-mode #sceneText {
  margin: 0 0 14px;
  text-wrap: pretty;
  hyphens: auto;
  -webkit-hyphens: auto;
}
.storybook-mode .choices {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}
@media (min-width: 520px) {
  .storybook-mode .choices { grid-template-columns: 1fr 1fr; }
}
.storybook-mode .choices .btn {
  background: #f3e8c8 url('../public/frames/scroll-button.svg') center/110% 110% no-repeat;
  border: 1px solid #decfa3;
  color: #5b4636;
  font-weight: 700;
  padding: 12px 14px;
}
.storybook-mode .choices .btn:focus-visible {
  outline: 2px solid #8b6f4f;
  outline-offset: 2px;
}
.storybook-mode .controls { margin-top: 12px; }
.storybook-mode .controls .btn {
  background: var(--color-primary);
  color: #fff;
  font-weight: 700;
}
@media (prefers-reduced-motion: reduce) {
  .storybook-mode * { transition: none !important; animation: none !important; }
} 

/* Storybook video chrome: SVG-bounded masks */
.storybook-mode .video-card { background: transparent; border: 0; box-shadow: none; padding: 0; }
.storybook-mode .video-row { gap: 12px; }
.storybook-mode .video-box { position: relative; overflow: hidden; background: none; }
/* Ensure consistent sizing */
.storybook-mode .video-box:nth-child(1) { aspect-ratio: 4 / 3; }
.storybook-mode .video-box:nth-child(2) { aspect-ratio: 1 / 1; }
.storybook-mode .video-box video { width: 100%; height: 100%; object-fit: cover; display: block; }
/* Apply SVG masks (WebKit + standard) */
.storybook-mode .video-box:nth-child(1) video {
  -webkit-mask-image: url('../public/frames/rect-mask.svg');
  -webkit-mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  mask-image: url('../public/frames/rect-mask.svg');
  mask-size: contain;
  mask-repeat: no-repeat;
  mask-position: center;
}
.storybook-mode .video-box:nth-child(2) video {
  -webkit-mask-image: url('../public/frames/oval-mask.svg');
  -webkit-mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  mask-image: url('../public/frames/oval-mask.svg');
  mask-size: contain;
  mask-repeat: no-repeat;
  mask-position: center;
}
@media (max-width: 640px) { .storybook-mode .video-row { grid-template-columns: 1fr; } }

/* Hide any small per-video autoplay prompts in storybook mode */
.storybook-mode .video-box .tap-to-play,
.storybook-mode .video-box .enable-audio { display: none !important; }

/* Storybook start overlay */
.storybook-start-overlay { position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.35); }
.storybook-start-overlay .panel { background: #fff; border-radius: 16px; padding: 20px 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.18); text-align: center; max-width: 90%; }
.storybook-start-overlay .panel h2 { font-family: 'Fraunces', serif; margin: 0 0 8px; }
.storybook-start-overlay .panel p { margin: 0 0 14px; }
.storybook-start-overlay .panel .start-btn { padding: 12px 16px; border-radius: 10px; border: none; background: var(--color-primary); color: #fff; font-weight: 800; cursor: pointer; } 

/* Storybook header/menu */
.storybook-mode .sb-menu-btn {
  position: fixed; top: 12px; right: 12px; z-index: 10000;
  border: none; border-radius: 999px; padding: 10px 14px;
  background: rgba(44,62,122,0.95); color: #fff; font-weight: 800; cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,0.18);
}
.storybook-mode .sb-session-overlay {
  position: fixed; top: 0; left: 0; right: 0; z-index: 9998;
  background: rgba(255,255,255,0.98);
  border-bottom: 1px solid #e8e6df;
  transform: translateY(-100%);
  transition: transform 200ms ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
}
.storybook-mode .sb-session-overlay.open { transform: translateY(0); }
.storybook-mode .sb-session-content { max-width: 960px; margin: 0 auto; padding: 12px 16px; }
/* Hide the original session card in storybook mode (we’ll mirror its controls) */
.storybook-mode .session-card { display: none; }
/* But show session cards inside the overlay */
.storybook-mode .sb-session-overlay .session-card { display: block; } 

/* Storybook page surface */
.storybook-mode .story-card {
  position: relative;
}
.storybook-mode .story-card::before {
  content: '';
  position: absolute; inset: 10px 8px 12px;
  background: #fbf7eb;
  border-radius: 18px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.10);
  z-index: 0;
}
.storybook-mode .story-content { position: relative; z-index: 1; } 

/* Ensure start overlay text is visible on white panel */
.storybook-start-overlay .panel { color: var(--color-ink); }

/* Video-first mode */
.video-first { height: 100%; overflow: hidden; }
html.video-first, html.video-first body { height: 100svh; overflow: hidden; }
@supports not (height: 100svh) {
  html.video-first, html.video-first body { height: 100vh; }
}
.video-first body { background: #000; color: #fff; }
.video-first .container { max-width: none; margin: 0; padding: 0; }
.video-first .site-header { display: none; }
.video-first main.container { width: 100%; }
.video-first .video-card { background: transparent; border: 0; border-radius: 0; padding: 0; margin: 0; }
.video-first .video-row { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr; gap: 0; height: 100%; }
@supports not (height: 100svh) {
  .video-first .video-row { height: 100%; }
}
.video-first .video-box { border-radius: 0; background: #000; min-height: auto; position: relative; }
.video-first .video-box video { width: 100%; height: 100%; object-fit: cover; display: block; }
@media (max-aspect-ratio: 3/4) {
  .video-first .video-row { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; }
  /* Bottom overlay sizing for portrait */
  .video-first .vf-overlay { padding: 8px env(safe-area-inset-right) calc(8px + env(safe-area-inset-bottom)) env(safe-area-inset-left); height: 28svh; }
  @supports not (height: 28svh) {
    .video-first .vf-overlay { height: 28vh; }
  }
  .video-first .vf-overlay .scrim { height: 100%; overflow: auto; -webkit-overflow-scrolling: touch; padding: 10px 12px; }
  .video-first .vf-overlay #sceneText { font-size: clamp(14px, 4vw, 18px); line-height: 1.5; }
  .video-first .vf-overlay .choices .btn { padding: 8px 12px; font-size: 0.95em; }
  .video-first .vf-controls { top: 8px; left: 8px; gap: 6px; }
  .video-first .vf-controls .icon-btn { width: 32px; height: 32px; }
}
/* Hide non-essential cards */
.video-first .story-card, .video-first .session-card, .video-first .safety-note { display: none; }
/* Ensure session overlay is visible */
.video-first .sb-session-overlay { display: block; }
/* Story overlay zone (uses existing #sceneText/#choices content we’ll mirror) */
.video-first .vf-overlay { position: fixed; left: 0; right: 0; bottom: 0; padding: 12px env(safe-area-inset-right) calc(12px + env(safe-area-inset-bottom)) env(safe-area-inset-left); z-index: 1000; }
.video-first .vf-overlay .scrim { background: linear-gradient(to top, rgba(0,0,0,0.4), rgba(0,0,0,0)); border-radius: 12px; padding: 12px 14px; backdrop-filter: blur(6px); }
@supports not ((backdrop-filter: blur(1px))) {
  .video-first .vf-overlay .scrim { background: rgba(0,0,0,0.4); }
}
.video-first .vf-overlay #storyTitle { display: none; }
.video-first .vf-overlay #sceneText { margin: 0 0 10px; font-size: clamp(16px, 2.4vw, 22px); line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.6); }
.video-first .vf-overlay .choices { display: flex; gap: 8px; flex-wrap: wrap; }
.video-first .vf-overlay .choices .btn { background: rgba(255,255,255,0.15); color: #fff; border: 1px solid rgba(255,255,255,0.25); border-radius: 999px; padding: 10px 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
.video-first .vf-overlay .controls { display: none; }
/* Show Menu button in video-first as well */
.video-first .sb-menu-btn { position: fixed; top: 10px; right: 10px; z-index: 10002; background: rgba(0,0,0,0.55); color: #fff; border: 1px solid rgba(255,255,255,0.35); border-radius: 999px; padding: 8px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
.video-first .sb-menu-btn:active { transform: scale(0.98); }
.video-first .sb-menu-btn.open { background: rgba(0,0,0,0.7); }

/* Backdrop for closing the panel on outside click */
.video-first .sb-session-backdrop { position: fixed; inset: 0; z-index: 9997; display: none; background: transparent; }
.video-first .sb-session-backdrop.open { display: block; }

/* Video-first header/menu panel */
.video-first .sb-session-overlay {
  position: fixed; top: 0; left: 0; right: 0; z-index: 9998;
  background: rgba(255,255,255,0.98);
  border-bottom: 1px solid #e8e6df;
  transform: translateY(-100%);
  transition: transform 200ms ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  color: var(--color-ink);
}
.video-first .sb-session-overlay.open { transform: translateY(0); }
.video-first .sb-session-content { max-width: 960px; margin: 0 auto; padding: 12px 16px; }
/* Ensure the cloned session cards show inside the overlay */
.video-first .sb-session-overlay .session-card { display: block; } 